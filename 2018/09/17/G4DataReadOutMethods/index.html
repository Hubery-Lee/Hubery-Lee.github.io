<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="yandex-verification" content="3ac9ae36ddebb425">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hubery-lee.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1},"motion":{"enable":false},"path":"search.json"};
  </script>

  <meta name="description" content="This page introduce different methods to read out data from geant4 simulation; This page focus on StepAction and Hit with SD method.">
<meta name="keywords" content="geant4">
<meta property="og:type" content="article">
<meta property="og:title" content="Gean4 Data Read Out Methods">
<meta property="og:url" content="https://Hubery-Lee.github.io/2018/09/17/G4DataReadOutMethods/index.html">
<meta property="og:site_name" content="Hubery-Lee">
<meta property="og:description" content="This page introduce different methods to read out data from geant4 simulation; This page focus on StepAction and Hit with SD method.">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://hubery-lee.github.io/2018/09/17/G4DataReadOutMethods/Geant4%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA%E6%96%B9%E5%BC%8F.png">
<meta property="og:image" content="https://hubery-lee.github.io/2018/09/17/G4DataReadOutMethods/Geant4SD_Hit.png">
<meta property="og:updated_time" content="2020-04-28T00:37:02.501Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Gean4 Data Read Out Methods">
<meta name="twitter:description" content="This page introduce different methods to read out data from geant4 simulation; This page focus on StepAction and Hit with SD method.">
<meta name="twitter:image" content="https://hubery-lee.github.io/2018/09/17/G4DataReadOutMethods/Geant4%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA%E6%96%B9%E5%BC%8F.png">

<link rel="canonical" href="https://Hubery-Lee.github.io/2018/09/17/G4DataReadOutMethods/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Gean4 Data Read Out Methods | Hubery-Lee</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Hubery-Lee" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hubery-Lee</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">蒹葭苍苍，白露为霜</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">28</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">12</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">34</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0h1YmVyeS1MZWU=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://Hubery-Lee.github.io/2018/09/17/G4DataReadOutMethods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/owl.jpg">
      <meta itemprop="name" content="李会">
      <meta itemprop="description" content="Get busy living or get busy dying.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hubery-Lee">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Gean4 Data Read Out Methods
        </h1>

        <div class="post-meta">

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/09/17/G4DataReadOutMethods/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/09/17/G4DataReadOutMethods/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">This page introduce different methods to read out data from geant4 simulation; This page focus on StepAction and Hit with SD method.</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Introduction-of-Data-Aquisition-Methods-in-Geant4-Simulation"><a href="#Introduction-of-Data-Aquisition-Methods-in-Geant4-Simulation" class="headerlink" title="Introduction of Data Aquisition Methods in Geant4 Simulation"></a>Introduction of Data Aquisition Methods in Geant4 Simulation</h2><ul>
<li>G4ScoringManager</li>
<li>SteppingAction</li>
<li>TrackingAction</li>
<li>SensitiveDetctor + HitCollection</li>
</ul>
<p><img src="/2018/09/17/G4DataReadOutMethods/Geant4%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA%E6%96%B9%E5%BC%8F.png" alt="Geant4 Data Read Out Method"></p>
<p>More detail information about these methods to get data can you refer to <span class="exturl" data-url="aHR0cHM6Ly93ZW5rdS5iYWlkdS5jb20vdmlldy9mMTNmNDcyNWJlMjM0ODJmYjVkYTRjNjMuaHRtbA==">this site<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">A: To get the information at tracking time in a given volume A, one can adopt either one or a combination of the following strategies:</span><br><span class="line"></span><br><span class="line">1.  If the geometry is simple enough, and wish to score some commonly used physics quantities (e.g. energy deposition, dose, flux, etc.), just activate G4ScoringManager in your main program, and use the scorer-based UI commands to transform volume A into a scorer.</span><br><span class="line"></span><br><span class="line">    See Option 6 below, and the example examples/extended/runAndEvent/RE03.</span><br><span class="line"></span><br><span class="line">2.  Through the SteppingAction, check that the particle is inside volume A and do whatever needed. Hints can be found in the previous chapter of this FAQ document.</span><br><span class="line"></span><br><span class="line">    Usually, the hits containers and histograms are attributes of a Track, Event or Run and can be managed through either a TrackingAction, EventAction and/or RunAction and eventually messaging their pointer to the SteppingAction.</span><br><span class="line"></span><br><span class="line">    A similar approach is illustrated in examples/basic/B2, B4, extended/electromagnetic, optical, and many others…</span><br><span class="line"></span><br><span class="line">3.  In DetectorConstruction, by declaring volume A as a SensitiveDetector. At stepping time, the Geant4 kernel will automatically check that a particle is inside volume A and will handle the control to a specific function G4VSensitiveDetector::ProcessHits(). It is just necessary to instanciate a class inherited from G4VSensitiveDetector, say VolumeA_SD, and do whatever needed by implementing the function VolumeA_SD::ProcessHits(), as described in Option 2 above.</span><br><span class="line"></span><br><span class="line">4.  In addition to Option 3 above, should create a HitsCollection to store the information. A HitsCollection can be created in VolumeA_SD::Initialize(). A Hit can be created or filled in VolumeA_SD::ProcessHits(). Additional operations on HitsCollection can be performed in VolumeA_SD::EndOfEvent().</span><br><span class="line"></span><br><span class="line">    This approach is illustrated in examples/basic/B2, B4 and extended/analysis, extended/runAndEvent/RE01, etc…</span><br><span class="line"></span><br><span class="line">5.  In DetectorConstruction, volume A can be declared as SensitiveDetector, and one or several pre-defined scorers can be attached to volume A. In this case, neither a SteppingAction nor a spcific VolumeA_SD sensitive detector is needed any longer. It is just necessary to create a dedicated scorer, e.g. MyRunScorer, inherited from G4Run, and handle the HitsCollections within MyRunScorer::RecordEvent(). MyRunScorer itself can be instanciated from RunAction::GenerateRun().</span><br><span class="line"></span><br><span class="line">    This approach is illustrated in examples/novice/N07, extended/runAndEvent/RE02.</span><br><span class="line"></span><br><span class="line">6.  A set of build-in scorer-based UI commands allows to perform most possible operations described through the previous Option 5 directly from run-time macros.</span><br><span class="line"></span><br><span class="line">    See example extended/runAndEvent/RE03.</span><br></pre></td></tr></table></figure>

<h2 id="Detector-Response"><a href="#Detector-Response" class="headerlink" title="Detector Response"></a>Detector Response</h2><p>对于Geant4模拟数据输出与存储可以参看<code>examples/basic/B4</code>,对于不同的数据输出方式，看该文件夹下的<code>README</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">6- DETECTOR RESPONSE</span><br><span class="line"></span><br><span class="line">  The energy deposit and track lengths of the charged particles are recorded on</span><br><span class="line">  an event by event basis in the Absober and Gap layers.</span><br><span class="line">  </span><br><span class="line">  In order to demonstrate several possible ways of data scoring,</span><br><span class="line">  the example is provided in four variants:</span><br><span class="line">  </span><br><span class="line">  Variant a: User Actions</span><br><span class="line">  </span><br><span class="line">    These 4 quantities are data members of the B4aEventAction class.  </span><br><span class="line">    They are collected step by step in </span><br><span class="line">    B4aSteppingAction::UserSteppingAction(), and passed to the event action</span><br><span class="line">    via two methods: B4aEventAction::AddAbs() and B4aEventAction::AddGap().</span><br><span class="line">  </span><br><span class="line">    In B4aEventAction::EndOfEventAction(), these quantities are printed and </span><br><span class="line">    filled in H1D histograms and ntuple to accumulate statistic and compute </span><br><span class="line">    dispersion.</span><br><span class="line">    </span><br><span class="line">  Variant b: User data object </span><br><span class="line">  </span><br><span class="line">    In order to avoid dependencies between action classes, a user object</span><br><span class="line">    B4bRunData, derived from G4Run, is defined with data members needed </span><br><span class="line">    for the accounted information. </span><br><span class="line">    In order to reduce the number of data members a 2-dimensions array</span><br><span class="line">    is introduced for each quantity.</span><br><span class="line">    Then the quantities are collected step by step in user action classes:</span><br><span class="line">    B4bSteppingAction::UserSteppingAction() and </span><br><span class="line">    B4bEventAction::EndOfEventAction() in a similar way as in variant a. </span><br><span class="line">    </span><br><span class="line">  Variant c: Hits and Sensitive detectors</span><br><span class="line">  </span><br><span class="line">    In this option, the physics quantities are accounted using the hits</span><br><span class="line">    and sensitive detectors framework defined in the Geant4 kernel.  </span><br><span class="line">    The physics quantities are stored in B4cCalorHit via two B4cCalorimeterSD</span><br><span class="line">    objects, one associated with the Absorber volume and another one with Gap</span><br><span class="line">    in B4cDetectorConstruction::ConstructSDandField().</span><br><span class="line">    </span><br><span class="line">    In contrary to the B2 example (Tracker) where a new hit is created</span><br><span class="line">    with each track passing the sensitive volume (in the calorimeter), only one</span><br><span class="line">    hit is created for each calorimeter layer and one more hit to account for</span><br><span class="line">    the total quantities in all layers. In addition to the variants a and b,</span><br><span class="line">    the quantities per each layer are also available in addition to the total </span><br><span class="line">    quantities.</span><br><span class="line">    </span><br><span class="line">  Variant d: Scorer</span><br><span class="line">   </span><br><span class="line">    In this option, the Geant4 scorers which are defined on the top of hits</span><br><span class="line">    and sensitive detectors Geant4 framework are used.  </span><br><span class="line">    In practice this means that the user does not need to define hits and sensitive</span><br><span class="line">    detector classes but rather uses the classes already defined</span><br><span class="line">    in Geant4. In this example, the G4MultiFunctionalDetector with</span><br><span class="line">    G4PSEnergyDeposit and G4PSTrackLength primitive scores are used (see</span><br><span class="line">    B4dDetectorConstruction::ConstructSDandField()).</span><br><span class="line">   </span><br><span class="line">    Also with this approach, the quantities per each layer are available </span><br><span class="line">    in addition to the total quantities.</span><br><span class="line">      </span><br><span class="line"> 7- HISTOGRAMS</span><br><span class="line"></span><br><span class="line">  The analysis tools are used to accumulate statistics and compute the dispersion</span><br><span class="line">  of the energy deposit and track lengths of the charged particles.</span><br><span class="line">  H1D histograms are created in B4[b]RunAction::B4[b]RunAction() for the </span><br><span class="line">  following quantities:</span><br><span class="line">  - Energy deposit in absorber</span><br><span class="line">  - Energy deposit in gap</span><br><span class="line">  - Track length in absorber</span><br><span class="line">  - Track length in gap</span><br><span class="line">  The same values are also saved in an ntuple.</span><br><span class="line"></span><br><span class="line">  The histograms and the ntuple are saved in the output file in a format</span><br><span class="line">  according to a technology selected in B4Analysis.hh, the default in this example</span><br><span class="line">  is ROOT.</span><br><span class="line"></span><br><span class="line">  The accumulated statistic and computed dispersion is printed at the end of </span><br><span class="line">  run, in B4RunAction::EndOfRunAction().</span><br><span class="line">  When running in multi-threading mode, the histograms and the ntuple accumulated </span><br><span class="line">  on threads are merged in a single output file. While merging of histograms is</span><br><span class="line">  performed by default, merging of ntuples is explicitly activated in the B4RunAction </span><br><span class="line">  constructor.</span><br><span class="line"></span><br><span class="line">  The ROOT histograms and ntuple can be plotted with ROOT using the plotHisto.C</span><br><span class="line">  and plotNtuple.C macros.</span><br></pre></td></tr></table></figure>

<h2 id="Geant4-Simulation-Data-ReadOut-by-SensitiveDetctor-HitCollection-Methods"><a href="#Geant4-Simulation-Data-ReadOut-by-SensitiveDetctor-HitCollection-Methods" class="headerlink" title="Geant4 Simulation Data ReadOut by SensitiveDetctor + HitCollection Methods"></a>Geant4 Simulation Data ReadOut by SensitiveDetctor + HitCollection Methods</h2><h3 id="RunAction"><a href="#RunAction" class="headerlink" title="RunAction"></a>RunAction</h3><ul>
<li>RunAction()</li>
<li>~RunAction()</li>
<li>BegingOfRunAction(const G4Run *)</li>
<li>EndOfRunAction(const G4Run *)</li>
</ul>
<p>该方式的数据输出与存储参看<code>examples/basic/B4/B4c</code></p>
<h4 id="RunAction-构造函数"><a href="#RunAction-构造函数" class="headerlink" title="RunAction() 构造函数"></a>RunAction() 构造函数</h4><p>打开和关闭数据存储文件，在RunAction中；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// set printing event number per each event</span><br><span class="line">G4RunManager::GetRunManager()-&gt;SetPrintProgress(1);</span><br><span class="line"></span><br><span class="line">// Create analysis manager</span><br><span class="line">// The choice of analysis technology is done via selectin of a namespace</span><br><span class="line">// in B4Analysis.hh</span><br><span class="line">auto analysisManager = G4AnalysisManager::Instance();</span><br><span class="line">G4cout &lt;&lt; &quot;Using &quot; &lt;&lt; analysisManager-&gt;GetType() &lt;&lt; G4endl;</span><br><span class="line"></span><br><span class="line">analysisManager-&gt;SetVerboseLevel(1);</span><br><span class="line">analysisManager-&gt;SetNtupleMerging(true);  </span><br><span class="line">// Note: merging ntuples is available only with Root output</span><br><span class="line"></span><br><span class="line">// Book ntuples	   </span><br><span class="line"></span><br><span class="line">//Declare ntuples</span><br><span class="line">// Creating 1st ntuple</span><br><span class="line">//</span><br><span class="line">analysisManager-&gt;CreateNtuple(&quot;Det&quot;, &quot;xyz in Det&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleSColumn(&quot;SDName&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleIColumn(&quot;EventID&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleIColumn(&quot;ParentID&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleIColumn(&quot;TrackID&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleIColumn(&quot;StepID&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;Edep&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;PosX&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;PosY&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;PosZ&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;GlobalT&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;LocalT&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;ProperT&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;Ekin&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;Velocity&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;MomentX&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;MomentY&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleDColumn(&quot;MomentZ&quot;);</span><br><span class="line">analysisManager-&gt;CreateNtupleSColumn(&quot;ProC&quot;);</span><br><span class="line"></span><br><span class="line">analysisManager-&gt;FinishNtuple();</span><br></pre></td></tr></table></figure>

<p>主要设置模拟运行参数，运行显示、多线程文件合并等；</p>
<ul>
<li><code>注意</code><br><code>B4c</code>中将内容目录也在构造函数中创建，文件的创建在BeginOfRunAction()中。</li>
</ul>
<h4 id="RunAction-析构函数"><a href="#RunAction-析构函数" class="headerlink" title="~RunAction() 析构函数"></a>~RunAction() 析构函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete G4AnalysisManager::Instance();</span><br></pre></td></tr></table></figure>

<h4 id="BeginOfRunAction-const-G4Run"><a href="#BeginOfRunAction-const-G4Run" class="headerlink" title="BeginOfRunAction(const G4Run*)"></a>BeginOfRunAction(const G4Run*)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Get analysis manager</span><br><span class="line">auto analysisManager = G4AnalysisManager::Instance();</span><br><span class="line"></span><br><span class="line">// Open an output file</span><br><span class="line">//</span><br><span class="line">G4String fileName = &quot;APNIS&quot;;</span><br><span class="line">analysisManager-&gt;OpenFile(fileName);</span><br></pre></td></tr></table></figure>

<p>新建储存文件并打开文件</p>
<h4 id="EndOfRunAction-const-G4Run"><a href="#EndOfRunAction-const-G4Run" class="headerlink" title="EndOfRunAction(const G4Run*)"></a>EndOfRunAction(const G4Run*)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">auto analysisManager = G4AnalysisManager::Instance();</span><br><span class="line"></span><br><span class="line">// save histograms &amp; ntuple</span><br><span class="line">//</span><br><span class="line">analysisManager-&gt;Write();</span><br><span class="line">analysisManager-&gt;CloseFile();</span><br></pre></td></tr></table></figure>

<p>一个Run结束后的写文件</p>
<h3 id="EventAction"><a href="#EventAction" class="headerlink" title="EventAction"></a>EventAction</h3><p>采用SD+HitCollection方式存储数据，记录的是一个Event的所有Hit点的数据，那么Geant4中数据的存储就在EventAction中进行；</p>
<p>当然，如果你采用StepAction方式存储数据，你只需在StepAction中去存储数据就行了；</p>
<ul>
<li>EventAction()</li>
<li>~EventAction()</li>
<li>BeginOfEventAction(const G4Event*)</li>
<li>EndOfEventAction(const G4Event*)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">• beginOfEventAction() This method is invoked before converting the primary particles to G4Track</span><br><span class="line">objects. A typical use of this method would be to initialize and/or book histograms for a particular event.</span><br><span class="line">• endOfEventAction() This method is invoked at the very end of event processing. It is typically used for</span><br><span class="line">a simple analysis of the processed event. If the user wants to keep the currently processing event until</span><br><span class="line">the end of the current run, the user can invoke fpEventManager-&gt;KeepTheCurrentEvent(); so</span><br><span class="line">that it is kept in G4Run object. This should be quite useful if you simulate quite many events and want to</span><br><span class="line">visualize only the most interest ones after the long execution. Given the memory size of an event and its</span><br><span class="line">contents may be large, it is the user’s responsibility not to keep unnecessary events.</span><br></pre></td></tr></table></figure>

<h4 id="EndOfEventAction-const-G4Event"><a href="#EndOfEventAction-const-G4Event" class="headerlink" title="EndOfEventAction(const G4Event*)"></a>EndOfEventAction(const G4Event*)</h4><p>在每个Event结束时，将Hit数据存储写到存储文件中。首先获取这个Event有多少个HitCollection,（HitCollection编号HCID在Event开始前获得，在BegingOfEventAction()中定义），然后根据HCID查找对应的HitCollection，根据不同HitCollection的大小提取数据并写入到文件；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">G4HCofThisEvent * HCE = event-&gt;GetHCofThisEvent();//获得Event结束时，所有的HitCollection</span><br><span class="line"></span><br><span class="line">//根据HitCollecitonID名称，获取不同的CollectionID</span><br><span class="line">if(HCE)&#123;</span><br><span class="line">PrimaryHC = (PLANETOCOSPrimaryHitsCollection*)(HCE-&gt;GetHC(primaryCollID));</span><br><span class="line">FluxHC = (PLANETOCOSFluxHitsCollection*)(HCE-&gt;GetHC(fluxdetectorCollID));</span><br><span class="line">//FluxHC = (PLANETOCOSFluxHitsCollection*)(HCE-&gt;GetHC(1));</span><br><span class="line">//G4cout&lt;&lt;&quot;ANALYSE1&quot;&lt;&lt;std::endl;</span><br><span class="line">EdepHC = (PLANETOCOSEdepHitsCollection*)(HCE-&gt;GetHC(edepCollID));</span><br><span class="line">SoilEdepHC = (PLANETOCOSEdepHitsCollection*)(HCE-&gt;GetHC(edepSoilCollID));</span><br><span class="line"></span><br><span class="line">//EdepHC = (PLANETOCOSEdepHitsCollection*)(HCE-&gt;GetHC(2));</span><br><span class="line">PostTrackHC = (PLANETOCOSPostTrackHitsCollection*)(HCE-&gt;GetHC(post_trackCollID));</span><br><span class="line">//PostTrackHC = (PLANETOCOSPostTrackHitsCollection*)(HCE-&gt;GetHC(3));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BeginOfEventAction-const-G4Event"><a href="#BeginOfEventAction-const-G4Event" class="headerlink" title="BeginOfEventAction(const G4Event*)"></a>BeginOfEventAction(const G4Event*)</h4><p>在Event开始前的行为，可以写在这个函数中；如下，获得不同HitCollection的编码HCID；注意，不同的HitCollection 对应不同的SD；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> G4SDManager * SDman = G4SDManager::GetSDMpointer();</span><br><span class="line"> if(edepCollID&lt;0||primaryCollID&lt;0||fluxdetectorCollID&lt;0 ||post_trackCollID &lt;0 || edepSoilCollID&lt;0)&#123;</span><br><span class="line"> 	edepCollID = SDman-&gt;GetCollectionID(&quot;edepCol&quot;);</span><br><span class="line">edepSoilCollID = SDman-&gt;GetCollectionID(&quot;edepSoilCol&quot;);</span><br><span class="line">primaryCollID = SDman-&gt;GetCollectionID(&quot;primaryCol&quot;);</span><br><span class="line">  	fluxdetectorCollID = SDman-&gt;GetCollectionID(&quot;detCol&quot;);</span><br><span class="line">post_trackCollID = SDman-&gt;GetCollectionID(&quot;post_trackCol&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>当不考虑不同的SD，对所以SD的detector的响应都一样时采用如下方法读取数据；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">/////////////////////////////////////////////</span><br><span class="line">void APNISEventAction::EndOfEventAction(const G4Event* event)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  G4HCofThisEvent * hce = event-&gt;GetHCofThisEvent();</span><br><span class="line">  if (!hce) &#123;</span><br><span class="line">      G4ExceptionDescription msg;</span><br><span class="line">      msg &lt;&lt; &quot;No hits collection of this event found.&quot; &lt;&lt; G4endl; </span><br><span class="line">      G4Exception(&quot;APNISEventAction::EndOfEventAction()&quot;,</span><br><span class="line">                  &quot;APNISCode001&quot;, JustWarning, msg);</span><br><span class="line">      return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //get hit collection</span><br><span class="line">  if(hce)</span><br><span class="line">    &#123;</span><br><span class="line">      size_t nHCE=hce-&gt;GetCapacity();</span><br><span class="line">      for(size_t i=0;i&lt;nHCE;i++)&#123;//多个SD时用</span><br><span class="line">  	APNISTrackHitsCollection *HC =0;</span><br><span class="line">      HC = (APNISTrackHitsCollection *)(hce-&gt;GetHC(i));</span><br><span class="line">      if(HC) OneHitOrder(HC);//写数据	</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">////////////////////////////////////////////////////////////////</span><br><span class="line">void APNISEventAction::OneHitOrder(APNISTrackHitsCollection*HC)</span><br><span class="line">&#123;</span><br><span class="line">  //////////////////////////////////////////</span><br><span class="line">  //</span><br><span class="line">  // Fill histograms &amp; ntuple</span><br><span class="line">  //</span><br><span class="line">  //////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  // get analysis manager</span><br><span class="line">  auto analysisManager = G4AnalysisManager::Instance();</span><br><span class="line"></span><br><span class="line">  //analyse</span><br><span class="line">  G4int n_hit = HC-&gt;entries();</span><br><span class="line">  for(G4int i=0;i&lt;n_hit;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      G4String SDName =(*HC)[i]-&gt;GetSDName();</span><br><span class="line">      G4int    EventID=(*HC)[i]-&gt;GetEventID();//</span><br><span class="line">      G4int    ParentID=(*HC)[i]-&gt;GetParentID();//</span><br><span class="line">      G4int    TrackID=(*HC)[i]-&gt;GetTrackID();//</span><br><span class="line">      G4int    StepID=(*HC)[i]-&gt;GetStepID();//       // Total steps number up to now</span><br><span class="line">      G4double fEdep=(*HC)[i]-&gt;GetEdep();</span><br><span class="line">      G4ThreeVector fPos=(*HC)[i]-&gt;GetPos();</span><br><span class="line">      G4double GlobalTime=(*HC)[i]-&gt;GetGlobalTime();//                   //Time since event is created</span><br><span class="line">      G4double LocalTime=(*HC)[i]-&gt;GetLocalTime();//                  // Time since track is created</span><br><span class="line">      G4double ProperTime=(*HC)[i]-&gt;GetProperTime();//            // Time since track is created (in rest frame of particle)</span><br><span class="line">      G4double Ekin=(*HC)[i]-&gt;GetEkin();//                    </span><br><span class="line">      G4double Velocity=(*HC)[i]-&gt;GetVelocity();//</span><br><span class="line">      G4ThreeVector MomentumDirection = (*HC)[i]-&gt;GetMomentumDirection();      // Direction of momentum </span><br><span class="line">      G4String CreatorProcess=(*HC)[i]-&gt;GetCreatorProcess();//</span><br><span class="line"></span><br><span class="line">      //塞选思路</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      //存储数据</span><br><span class="line">      // fill ntuple</span><br><span class="line">      G4int Count=0;</span><br><span class="line">      analysisManager-&gt;FillNtupleSColumn(Count,SDName);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleIColumn(Count,EventID);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleIColumn(Count,ParentID);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleIColumn(Count,TrackID);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleIColumn(Count,StepID);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,fEdep/MeV);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,fPos.x()/m);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,fPos.y()/m);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,fPos.z()/m);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,GlobalTime/s);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,LocalTime/s);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,ProperTime/s);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,Ekin/MeV);Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,Velocity/(m/s));Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,MomentumDirection.x());Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,MomentumDirection.y());Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleDColumn(Count,MomentumDirection.z());Count++;</span><br><span class="line">      analysisManager-&gt;FillNtupleSColumn(Count,CreatorProcess);Count++;</span><br><span class="line"></span><br><span class="line">      // analysisManager-&gt;FillNtupleIColumn(Count,);Count++;</span><br><span class="line">      // analysisManager-&gt;FillNtupleDColumn(Count,);Count++;</span><br><span class="line">      // analysisManager-&gt;FillNtupleSColumn(Count,);Count++;</span><br><span class="line"></span><br><span class="line">      analysisManager-&gt;AddNtupleRow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Hit"><a href="#Hit" class="headerlink" title="Hit"></a>Hit</h3><p>参考Book for applicaiton中的4.4 <span class="exturl" data-url="aHR0cDovL2dlYW50NC11c2VyZG9jLndlYi5jZXJuLmNoL2dlYW50NC11c2VyZG9jL1VzZXJzR3VpZGVzL0ZvckFwcGxpY2F0aW9uRGV2ZWxvcGVyL2h0bWwvRGV0ZWN0b3IvaGl0Lmh0bWw=">Hits<i class="fa fa-external-link-alt"></i></span></p>
<p>A hit is a snapshot of the physical interaction of a track in the sensitive region of a detector. In it you can store<br>information associated with a G4Step object. This information can be</p>
<ul>
<li>the position and time of the step,</li>
<li>the momentum and energy of the track,</li>
<li>the energy deposition of the step,</li>
<li>geometrical information,</li>
<li>or any combination of the above.</li>
</ul>
<p><code>简而言之</code></p>
<ul>
<li>G4中的Hit &lt;==&gt; C++中的vector  ，G4Allocator会给Hit分配内存空间；</li>
<li>G4中的Map &lt;==&gt; C++中的map</li>
</ul>
<h4 id="Hit-hh头文件结构"><a href="#Hit-hh头文件结构" class="headerlink" title="Hit.hh头文件结构"></a>Hit.hh头文件结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">APNISTrackHit();</span><br><span class="line">APNISTrackHit(const APNISTrackHit &amp;right);</span><br><span class="line">virtual ~APNISTrackHit();</span><br><span class="line">//operator</span><br><span class="line">const APNISTrackHit&amp; operator=(const APNISTrackHit &amp;right);</span><br><span class="line">G4int operator ==(const APNISTrackHit &amp;right)const;</span><br><span class="line"></span><br><span class="line">inline void *operator new(size_t);</span><br><span class="line">inline void operator delete(void *aHit);</span><br><span class="line"></span><br><span class="line">//获取数据</span><br><span class="line">inline void SetSDName(G4String name)&#123;SDName=name;&#125;</span><br><span class="line">inline const G4String&amp; GetSDName() const&#123;return SDName;&#125;</span><br><span class="line"></span><br><span class="line">inline void SetEventID(G4int id)&#123;EventID=id;&#125;//ok</span><br><span class="line">inline G4int GetEventID() const&#123;return EventID;&#125;//</span><br><span class="line"></span><br><span class="line">inline void SetParentID(G4int id)&#123;ParentID=id;&#125;//ok</span><br><span class="line">inline G4int GetParentID() const&#123;return ParentID;&#125;//</span><br><span class="line"></span><br><span class="line">inline void SetTrackID(G4int id)&#123;TrackID=id;&#125;//ok</span><br><span class="line">inline G4int GetTrackID() const&#123;return TrackID;&#125;//</span><br><span class="line"></span><br><span class="line">inline void SetStepID(G4int id)&#123;CurrentStepNumber=id;&#125;//ok</span><br><span class="line">inline G4int GetStepID() const&#123;return CurrentStepNumber;&#125;//</span><br><span class="line"></span><br><span class="line">inline void SetEdep(G4double de)&#123; fEdep = de; &#125;</span><br><span class="line">inline G4double GetEdep()&#123; return fEdep; &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>分配HitCollection存储空间，新建内存空间用完后并释放内存空间；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">///////////////////////////////////////////////////////////////</span><br><span class="line">typedef G4THitsCollection&lt;APNISTrackHit&gt; APNISTrackHitsCollection;</span><br><span class="line"></span><br><span class="line">extern G4ThreadLocal G4Allocator&lt;APNISTrackHit&gt;* APNISTrackHitAllocator;</span><br><span class="line">//////////////////////////////////////////////////////////////</span><br><span class="line">inline void* APNISTrackHit::operator new(size_t)</span><br><span class="line">&#123;</span><br><span class="line">  if(!APNISTrackHitAllocator) APNISTrackHitAllocator = new G4Allocator&lt;APNISTrackHit&gt;;</span><br><span class="line">  return (void *)APNISTrackHitAllocator-&gt;MallocSingle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inline void APNISTrackHit::operator delete(void* aHit)</span><br><span class="line">&#123;</span><br><span class="line">  APNISTrackHitAllocator-&gt;FreeSingle((APNISTrackHit*)aHit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Hit-cc"><a href="#Hit-cc" class="headerlink" title="Hit.cc"></a>Hit.cc</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">////////////////////////////////////////////////////////</span><br><span class="line">APNISTrackHit::APNISTrackHit(const APNISTrackHit &amp;right):G4VHit()</span><br><span class="line">&#123;</span><br><span class="line">  SDName =right.SDName;</span><br><span class="line">  EventID=right.EventID;</span><br><span class="line">  ParentID =right.ParentID;</span><br><span class="line">  TrackID =right.TrackID;</span><br><span class="line">  CurrentStepNumber =right.CurrentStepNumber;</span><br><span class="line">  fEdep = right.fEdep;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">////////////////////////////////////////////////////////</span><br><span class="line">//</span><br><span class="line">// operator</span><br><span class="line">const APNISTrackHit&amp; APNISTrackHit::operator=(const APNISTrackHit &amp;right)</span><br><span class="line">&#123;</span><br><span class="line">  SDName =right.SDName;</span><br><span class="line">  EventID=right.EventID;</span><br><span class="line">  ParentID =right.ParentID;</span><br><span class="line">  TrackID =right.TrackID;</span><br><span class="line">  CurrentStepNumber =right.CurrentStepNumber;</span><br><span class="line">  fEdep = right.fEdep;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  return *this;</span><br><span class="line">&#125;</span><br><span class="line">////////</span><br><span class="line">G4int APNISTrackHit::operator==(const APNISTrackHit &amp;right) const</span><br><span class="line">&#123;</span><br><span class="line">  return (this==&amp;right) ? 1 : 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SensitiveDetector"><a href="#SensitiveDetector" class="headerlink" title="SensitiveDetector"></a>SensitiveDetector</h3><p>SD的作用时根据Step和Track信息，构建Hit信息；SD有以下一些函数：</p>
<ul>
<li>ProcessHits()</li>
<li>Initialize()</li>
<li>EndOfEvent()</li>
</ul>
<h4 id="ProcessHits-G4Step-aStep-G4TouchableHistory"><a href="#ProcessHits-G4Step-aStep-G4TouchableHistory" class="headerlink" title="ProcessHits(G4Step* aStep, G4TouchableHistory*)"></a>ProcessHits(G4Step* aStep, G4TouchableHistory*)</h4><p>在ProcessHits()中将数据存入Hit()申明的存储空间中;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ProcessHits() This method is invoked by G4SteppingManager when a step is composed in the</span><br><span class="line">G4LogicalVolume which has the pointer to this sensitive detector. The first argument of this method is</span><br><span class="line">a G4Step object of the current step. The second argument is a G4TouchableHistory object for the</span><br><span class="line">Readout geometry described in the next section. The second argument is NULL if Readout geometry</span><br><span class="line">is not assigned to this sensitive detector. In this method, one or more G4VHit objects should be constructed if</span><br><span class="line">the current step is meaningful for your detector.</span><br><span class="line">Initialize() This method is invoked at the beginning of each event. The argument of this method is an object</span><br><span class="line">of the G4HCofThisEvent class. Hit collections, where hits produced in this particular event are stored,</span><br><span class="line">can be associated with the G4HCofThisEvent object in this method. The hit collections associated with</span><br><span class="line">the G4HCofThisEvent object during this method can be used for during the event processing</span><br><span class="line">digitization.</span><br></pre></td></tr></table></figure>

<p>example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> G4StepPoint* preStepPoint=aStep-&gt;GetPreStepPoint();</span><br><span class="line"> G4StepPoint* postStepPoint=aStep-&gt;GetPostStepPoint();</span><br><span class="line"> G4Track* aTrack=aStep-&gt;GetTrack();</span><br><span class="line"></span><br><span class="line"> // G4double edep = aStep-&gt;GetTotalEnergyDeposit();</span><br><span class="line"> // if(edep==0.) return false;</span><br><span class="line"> G4ParticleDefinition* theparticle=aStep-&gt;GetTrack()-&gt;GetDefinition();</span><br><span class="line"> G4String PName=theparticle-&gt;GetParticleName();</span><br><span class="line"></span><br><span class="line"> G4TouchableHandle touch1 = preStepPoint-&gt;GetTouchableHandle();</span><br><span class="line"> G4VPhysicalVolume* volume = touch1-&gt;GetVolume();</span><br><span class="line"></span><br><span class="line">if(preStepPoint-&gt;GetStepStatus()==fGeomBoundary)</span><br><span class="line">  &#123;</span><br><span class="line">    // if(volume-&gt;GetName()==&quot;AirDet&quot;)</span><br><span class="line">    //   &#123;</span><br><span class="line">    APNISTrackHit* newHit1 = new APNISTrackHit();</span><br><span class="line">    // G4cout&lt;&lt;&quot;####----In AirDet----&quot;&lt;&lt;SensitiveDetectorName&lt;&lt;G4endl;</span><br><span class="line">    newHit1-&gt;SetSDName(volume-&gt;GetName());</span><br><span class="line">    newHit1-&gt;SetEventID(G4EventManager::GetEventManager()-&gt;GetConstCurrentEvent()-&gt;GetEventID());//ok</span><br><span class="line">    newHit1-&gt;SetParentID(aTrack-&gt;GetParentID());//ok</span><br><span class="line">    newHit1-&gt;SetTrackID(aTrack-&gt;GetTrackID());//ok</span><br><span class="line">    newHit1-&gt;SetStepID(aTrack-&gt;GetCurrentStepNumber());//ok</span><br><span class="line"></span><br><span class="line">    newHit1-&gt;SetEdep( aStep-&gt;GetTotalEnergyDeposit() );</span><br><span class="line">    newHit1-&gt;SetPos( aStep-&gt;GetPreStepPoint()-&gt;GetPosition());</span><br><span class="line">    newHit1-&gt;SetGlobalTime(preStepPoint-&gt;GetGlobalTime());//ok</span><br><span class="line">    newHit1-&gt;SetLocalTime(preStepPoint-&gt;GetLocalTime());//ok</span><br><span class="line">    newHit1-&gt;SetProperTime(preStepPoint-&gt;GetProperTime());//ok</span><br><span class="line">    newHit1-&gt;SetEkin(preStepPoint-&gt;GetKineticEnergy());//ok</span><br><span class="line">    newHit1-&gt;SetVelocity(preStepPoint-&gt;GetVelocity());//ok</span><br><span class="line">    newHit1-&gt;SetMomentumDirection(preStepPoint-&gt;GetMomentumDirection());//ok</span><br><span class="line">    const G4VProcess* pcr=aTrack-&gt;GetCreatorProcess();</span><br><span class="line">    if(pcr)newHit1-&gt;SetCreatorProcess(pcr-&gt;GetProcessName());</span><br><span class="line">    else newHit1-&gt;SetCreatorProcess(&quot;##&quot;);//ok</span><br><span class="line">    //数据存储到HitCollection中</span><br><span class="line">    fTrackHitCollection-&gt;insert( newHit1 );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Initialize-G4HCofThisEvent-HCE"><a href="#Initialize-G4HCofThisEvent-HCE" class="headerlink" title="Initialize(G4HCofThisEvent* HCE)"></a>Initialize(G4HCofThisEvent* HCE)</h4><p>初始化HitsCollection，将数据存入HitsCollection前都需将空间初始化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Initialize() This method is invoked at the beginning of each event. The argument of this method is an object</span><br><span class="line">of the G4HCofThisEvent class. Hit collections, where hits produced in this particular event are stored,</span><br><span class="line">can be associated with the G4HCofThisEvent object in this method. The hit collections associated with</span><br><span class="line">the G4HCofThisEvent object during this method can be used for during the event processing</span><br><span class="line">digitization.</span><br></pre></td></tr></table></figure>

<p>example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void PLANETOCOSSoilSD::Initialize(G4HCofThisEvent*HCE)</span><br><span class="line">&#123; static int HCID = -1;</span><br><span class="line">  </span><br><span class="line">  SoilEdepHitCollection = new PLANETOCOSEdepHitsCollection</span><br><span class="line">                                  (SensitiveDetectorName,collectionName[0]);</span><br><span class="line">  </span><br><span class="line">  HCID = GetCollectionID(0);</span><br><span class="line">  HCE-&gt;AddHitsCollection(HCID,SoilEdepHitCollection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">void B4cCalorimeterSD::Initialize(G4HCofThisEvent* hce)</span><br><span class="line">&#123;</span><br><span class="line">  // Create hits collection</span><br><span class="line">  fHitsCollection </span><br><span class="line">    = new B4cCalorHitsCollection(SensitiveDetectorName, collectionName[0]); </span><br><span class="line"></span><br><span class="line">  // Add this collection in hce</span><br><span class="line">  auto hcID </span><br><span class="line">    = G4SDManager::GetSDMpointer()-&gt;GetCollectionID(collectionName[0]);</span><br><span class="line">  hce-&gt;AddHitsCollection( hcID, fHitsCollection ); </span><br><span class="line"></span><br><span class="line">  // Create hits</span><br><span class="line">  // fNofCells for cells + one more for total sums </span><br><span class="line">  for (G4int i=0; i&lt;fNofCells+1; i++ ) &#123;</span><br><span class="line">    fHitsCollection-&gt;insert(new B4cCalorHit());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">void APNISTrackSD::Initialize(G4HCofThisEvent* HCE)</span><br><span class="line">&#123;</span><br><span class="line">  // static int HCID = -1;</span><br><span class="line">  fTrackHitCollection = new APNISTrackHitsCollection</span><br><span class="line">                      (SensitiveDetectorName,collectionName[0]); </span><br><span class="line">  // if(HCID&lt;0)</span><br><span class="line">  // &#123; HCID = GetCollectionID(0); &#125;</span><br><span class="line"></span><br><span class="line">  // get the collection name according to the object(name).</span><br><span class="line">  if(HCID&lt;0)&#123;</span><br><span class="line">    HCID = G4SDManager::GetSDMpointer()</span><br><span class="line">      -&gt;GetCollectionID(fTrackHitCollection);</span><br><span class="line">  &#125;</span><br><span class="line">  HCE-&gt;AddHitsCollection(HCID,fTrackHitCollection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>到这里，数据文件打开，写入；数据的传递与存储就介绍完了；RunAction中实现对数据文件的打开与关闭；EventAction中实现将数据写入到文件，当然，如果你采用SteppingAction方式也可以将数据写入文件（此文不再介绍）；Hit中实现给需要传递的数据分配内存空间；SensitiveDetector中实现将数据传递给Hit分配的内存空间；如果将这个问题表述为送快递的过程，那么RunAction就是告诉快递员有堆快递需要在什么时候开始送，什么时候完全送达；EventAction就是需要送的快递，Hit就是送一份快递，给快递员分配的货箱大小；SensitiveDetector就是告诉快递员将货物放到货箱里；</p>
<p><img src="/2018/09/17/G4DataReadOutMethods/Geant4SD_Hit.png" alt="SensitiveDetector+HitsCollection方式存储数据方法示意图"></p>

    </div>

    
    
    
        <div class="reward-container">
  <div>Donate comment here.</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat_pay.jpg" alt="李会 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechatsubscrible.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://github.com/Hubery-Lee">
            <span class="icon">
              <i class="fab fa-github"></i>
            </span>

            <span class="label">GitHub</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://blog.csdn.net/baidu_29950065">
            <span class="icon">
              <i class="fab fa-cuttlefish"></i>
            </span>

            <span class="label">CSDN</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/geant4/" rel="tag"><i class="fa fa-tag"></i> geant4</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/09/23/How-to-Use-Root-to-Draw-3D-Histogram/" rel="prev" title="How to Use Root to Draw 3D Histogram">
      <i class="fa fa-chevron-left"></i> How to Use Root to Draw 3D Histogram
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/09/14/Hexo-Next-theme-Setting/" rel="next" title="Hexo Next theme Setting">
      Hexo Next theme Setting <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction-of-Data-Aquisition-Methods-in-Geant4-Simulation"><span class="nav-number">1.</span> <span class="nav-text">Introduction of Data Aquisition Methods in Geant4 Simulation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Detector-Response"><span class="nav-number">2.</span> <span class="nav-text">Detector Response</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Geant4-Simulation-Data-ReadOut-by-SensitiveDetctor-HitCollection-Methods"><span class="nav-number">3.</span> <span class="nav-text">Geant4 Simulation Data ReadOut by SensitiveDetctor + HitCollection Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RunAction"><span class="nav-number">3.1.</span> <span class="nav-text">RunAction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RunAction-构造函数"><span class="nav-number">3.1.1.</span> <span class="nav-text">RunAction() 构造函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RunAction-析构函数"><span class="nav-number">3.1.2.</span> <span class="nav-text">~RunAction() 析构函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BeginOfRunAction-const-G4Run"><span class="nav-number">3.1.3.</span> <span class="nav-text">BeginOfRunAction(const G4Run*)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EndOfRunAction-const-G4Run"><span class="nav-number">3.1.4.</span> <span class="nav-text">EndOfRunAction(const G4Run*)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EventAction"><span class="nav-number">3.2.</span> <span class="nav-text">EventAction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#EndOfEventAction-const-G4Event"><span class="nav-number">3.2.1.</span> <span class="nav-text">EndOfEventAction(const G4Event*)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BeginOfEventAction-const-G4Event"><span class="nav-number">3.2.2.</span> <span class="nav-text">BeginOfEventAction(const G4Event*)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hit"><span class="nav-number">3.3.</span> <span class="nav-text">Hit</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Hit-hh头文件结构"><span class="nav-number">3.3.1.</span> <span class="nav-text">Hit.hh头文件结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hit-cc"><span class="nav-number">3.3.2.</span> <span class="nav-text">Hit.cc</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SensitiveDetector"><span class="nav-number">3.4.</span> <span class="nav-text">SensitiveDetector</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ProcessHits-G4Step-aStep-G4TouchableHistory"><span class="nav-number">3.4.1.</span> <span class="nav-text">ProcessHits(G4Step* aStep, G4TouchableHistory*)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Initialize-G4HCofThisEvent-HCE"><span class="nav-number">3.4.2.</span> <span class="nav-text">Initialize(G4HCofThisEvent* HCE)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结语"><span class="nav-number">3.5.</span> <span class="nav-text">结语</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="李会"
      src="/images/owl.jpg">
  <p class="site-author-name" itemprop="name">李会</p>
  <div class="site-description" itemprop="description">Get busy living or get busy dying.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0h1YmVyeS1MZWU=" title="GitHub → https://github.com/Hubery-Lee"><i class="fab fa-github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzI5OTUwMDY1" title="CSDN → https://blog.csdn.net/baidu_29950065"><i class="fab fa-cuttlefish fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93ZWliby5jb20vMjgyMzkyNjU5MC9wcm9maWxlP3JpZ2h0bW9kPTEmd3ZyPTYmbW9kPXBlcnNvbmluZm8maXNfYWxsPTE=" title="Weibo → https://weibo.com/2823926590/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1"><i class="fab fa-weibo fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTM1NzY5MjU0Mg==" title="Netease → https://music.163.com/#/user/home?id=357692542"><i class="fas fa-music fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmhyYmV1bGhAMTI2LmNvbQ==" title="E-Mail → mailto:hrbeulh@126.com"><i class="fas fa-envelope fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbQ==" title="Runoob → https://www.runoob.com"><i class="fas fa-cube fa-fw"></i></span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cDovL2dlYW50NC53ZWIuY2Vybi5jaC8=" title="http://geant4.web.cern.ch/">Geant4</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9yb290LmNlcm4uY2gv" title="https://root.cern.ch/">Root</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cDovL3d3dy5hcGMudW5pdi1wYXJpczcuZnIvfmZyYW5jby9nNGRveHk0LjEwL2h0bWwvYW5ub3RhdGVkLmh0bWw=" title="http://www.apc.univ-paris7.fr/~franco/g4doxy4.10/html/annotated.html">G4ClassIndex</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9yb290LmNlcm4vZG9jL21hc3Rlci9tb2R1bGVzLmh0bWw=" title="https://root.cern/doc/master/modules.html">RootClassIndex</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly93dWhvbmd5aS5jbg==" title="https://wuhongyi.cn">wuhongyi</span>
        </li>
    </ul>
  </div>
<div class="cc-license motion-element" itemprop="sponsor">
  <span class="exturl cc-opacity" title="Deploy with Netlify → https://www.netlify.com" data-url="aHR0cHM6Ly93d3cubmV0bGlmeS5jb20="><img width="80" src="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Netlify"></span>
</div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李会</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  <script src="/js/local-search.js"></script>








<script data-pjax>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'ooozwlclX00aJabPvk1WTj7J-gzGzoHsz',
      appKey     : 'CnXrRUVdUdMXgEvGbdolWGYX',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

    </div>
</body>
</html>
